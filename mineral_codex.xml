<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, April 24, 2024, 10:38 PM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "test" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mineral_codex"
   author="Sylva"
   id="bbc565e643b4de02a865a89a"
   language="Lua"
   purpose="Gives you extra information as you are prospecting"
   date_written="2024-04-24 22:37:52"
   requires="5.06"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   match = "You uncover a deposit of\s(.*?)(?:,|and)"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>Note(FindClosestMineral("%1"))</send>
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
lapidaryMinerals = {
    { mineral = 'agate',               primary = 'MANA_REGEN',   secondary = 'Random',       spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'aetherstone',         primary = 'SHIELD_BLOCK', secondary = 'PARRY',        spell_comp = 'Yes', affinity = 'force fields' },
    { mineral = 'alabaster',           primary = 'CHR',          secondary = 'MANA_REGEN',   spell_comp = 'Yes', affinity = 'Curse' },
    { mineral = 'albite',              primary = 'MOV_REGEN',    secondary = 'PARRY',        spell_comp = 'Yes', affinity = 'Curse' },
    { mineral = 'amber',               primary = 'ABSORB_ZAP',   secondary = 'AGE',          spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'amethyst',            primary = 'SAVE_ZAP',     secondary = 'SAVE_PIOSON',  spell_comp = 'Yes', affinity = 'Healing' },
    { mineral = 'ametrine',            primary = 'SAVE_ZAP',     secondary = 'SPELL_RES',    spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'ammolite',            primary = 'MANA_REGEN',   secondary = 'AGE',          spell_comp = 'Yes', affinity = 'illusion' },
    { mineral = 'ancient fossils',     primary = 'AGE',          secondary = 'INT',          spell_comp = 'Yes', affinity = 'Shadow' },
    { mineral = 'anhydrite',           primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'crystal spear' },
    { mineral = 'anorthite',           primary = 'HIT_POINTS',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'apataite (piece of)', primary = 'SHIELD BLOCK', secondary = 'CON',          spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'aquamarine',          primary = 'SAVE_POISON',  secondary = 'SAVE_SPELL',   spell_comp = 'Yes', affinity = 'prism' },
    { mineral = 'argillite',           primary = 'HP_REGEN',     secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'aventurine',          primary = 'SPELL_RES',    secondary = 'SAVE_ZAP',     spell_comp = '',    affinity = '' },
    { mineral = 'axinite',             primary = 'SNEAK',        secondary = 'MOV_REGEN',    spell_comp = 'Yes', affinity = 'illusion' },
    { mineral = 'basalt',              primary = 'CON',          secondary = 'ARMOR',        spell_comp = '',    affinity = '' },
    { mineral = 'black diamond',       primary = 'ARMOR',        secondary = 'HIT_POINTS',   spell_comp = 'No',  affinity = '' },
    { mineral = 'black obsidian',      primary = 'SAVE_FIRE',    secondary = 'HIT_POINTS',   spell_comp = 'Yes', affinity = 'Fire' },
    { mineral = 'black opal',          primary = 'HPREGEN',      secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'block of ice',        primary = 'ABSORB_ICE',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'bloedite',            primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'blood quartz',        primary = 'SAVE_ZAP',     secondary = 'DAMROLL',      spell_comp = 'Yes', affinity = 'Fire' },
    { mineral = 'bloodstone',          primary = 'CON',          secondary = 'MOV_REGEN',    spell_comp = '',    affinity = '' },
    { mineral = 'blue diamond',        primary = 'HITROLL',      secondary = 'ATTACK_SPEED', spell_comp = '',    affinity = '' },
    { mineral = 'blue jade',           primary = 'LUCK',         secondary = 'CAST_ABILITY', spell_comp = '',    affinity = '' },
    { mineral = 'blue quartz',         primary = 'SAVE_ZAP',     secondary = 'MANA_REGEN',   spell_comp = 'Yes', affinity = 'Healing' },
    { mineral = 'blue topaz',          primary = 'SAVE_BREATH',  secondary = 'SAVE_COLD',    spell_comp = '',    affinity = '' },
    { mineral = 'boracite',            primary = 'MANA_REGEN',   secondary = 'DAMROLL',      spell_comp = 'Yes', affinity = 'n/a' },
    { mineral = 'borax',               primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'preservation' },
    { mineral = 'brimstone',           primary = 'ABSORB_FIRE',  secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'brown sandstone',     primary = 'MOVE',         secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'brown standstone',    primary = 'MOVE',         secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'calcite',             primary = 'INT',          secondary = 'CHR',          spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'calthemite',          primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'crystal light' },
    { mineral = 'carnelian',           primary = 'WIS',          secondary = 'INT',          spell_comp = 'Yes', affinity = 'Blood' },
    { mineral = 'celestine',           primary = 'SAVE_COLD',    secondary = 'MANA_REGEN',   spell_comp = '',    affinity = '' },
    { mineral = 'chalk',               primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'sanctuary' },
    { mineral = 'charoite',            primary = 'SAVE_SPELL',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'chert',               primary = 'SAVE_ZAP',     secondary = 'SHIELD_BLOCK', spell_comp = 'Yes', affinity = 'shards' },
    { mineral = 'chocolate diamond',   primary = 'HITROLL',      secondary = 'DAMROLL',      spell_comp = '',    affinity = '' },
    { mineral = 'chondodrite',         primary = 'MANA_REGEN',   secondary = 'CAST_ABILITY', spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'chrysoberol',         primary = 'CAST_ABILITY', secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'chrysoberyl',         primary = 'CAST_ABILITY', secondary = 'CAST_ABILITY', spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'chrysoprase',         primary = 'MOV_REGEN',    secondary = 'MOVE',         spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'cinnabar',            primary = 'SAVE_POISON',  secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'citrine quartz',      primary = 'SAVE_ZAP',     secondary = 'MANA',         spell_comp = '',    affinity = '' },
    { mineral = 'citrine',             primary = 'SAVE_ZAP',     secondary = '',             spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'clear quartz',        primary = 'SAVE_ZAP',     secondary = 'INT',          spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'clinohumite',         primary = 'SAVE_FIRE?',   secondary = 'DODGE?',       spell_comp = 'Yes', affinity = 'force fields' },
    { mineral = 'coal',                primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'fire' },
    { mineral = 'cuprite',             primary = 'SAVE_ZAP',     secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'datolite',            primary = 'MOV_REGEN',    secondary = 'ATTACK_SPEED', spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'demon-eye stone',     primary = 'ABSORB_FIRE',  secondary = 'SAVE_BREATH',  spell_comp = 'Yes', affinity = 'torment' },
    { mineral = 'diatomite',           primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'diopside',            primary = 'SPELL_RES',    secondary = 'MANA',         spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'diorite',             primary = 'ARMOR',        secondary = 'CON',          spell_comp = '',    affinity = '' },
    { mineral = 'dolostone',           primary = 'CON',          secondary = 'PARRY',        spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'dragonfang quartz',   primary = 'SAVE_ZAP',     secondary = 'HITROLL',      spell_comp = 'Yes', affinity = 'Healing' },
    { mineral = 'earth tears',         primary = 'MANA_REGEN',   secondary = 'INT',          spell_comp = '',    affinity = '' },
    { mineral = 'ebonite',             primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'ground' },
    { mineral = 'emerald',             primary = 'SAVE_POISON',  secondary = 'SAVE_SPELL',   spell_comp = '',    affinity = 'sac' },
    { mineral = 'epidote',             primary = 'DODGE',        secondary = 'DEX',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'epsomite',            primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'healing' },
    { mineral = 'euclase',             primary = 'SAVE_COLD',    secondary = 'ABSORB_ICE',   spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'flint',               primary = 'SAVE_ZAP',     secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'fluorite',            primary = 'MANA',         secondary = '',             spell_comp = 'Yes', affinity = 'Illusion' },
    { mineral = 'flurorite',           primary = 'MANA',         secondary = '',             spell_comp = 'Yes', affinity = 'crystal spear' },
    { mineral = 'frostshard',          primary = 'ABSORB_ICE',   secondary = 'SAVE_BREATH',  spell_comp = 'Yes', affinity = 'ice spells' },
    { mineral = 'fulgurite',           primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'ball lightning' },
    { mineral = 'garnet',              primary = 'SAVE_COLD',    secondary = 'SAVE_FIRE',    spell_comp = 'Yes', affinity = 'Ice' },
    { mineral = 'gneiss',              primary = 'STR',          secondary = 'PARRY',        spell_comp = '',    affinity = '' },
    { mineral = 'golden beryl',        primary = 'SAVE_POISON',  secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'grandidierite',       primary = 'ATTACK_SPEED', secondary = 'DEX',          spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'granite',             primary = 'HIT_POINTS',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'green jade',          primary = 'LUCK',         secondary = 'CON',          spell_comp = '',    affinity = '' },
    { mineral = 'green obsidian',      primary = 'SAVE_FIRE',    secondary = 'LUCK',         spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'greenstone',          primary = 'PARRY',        secondary = 'ARMOR',        spell_comp = '',    affinity = '' },
    { mineral = 'hackmanite',          primary = 'WIS',          secondary = 'CHR',          spell_comp = '',    affinity = '' },
    { mineral = 'halite',              primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'protection from demons' },
    { mineral = 'hawk eye',            primary = 'DEX',          secondary = 'INT',          spell_comp = 'Yes', affinity = 'shadow' },
    { mineral = 'hawk-eye',            primary = 'DEX',          secondary = 'INT',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'heartstone',          primary = 'HP_REGEN',     secondary = 'CON',          spell_comp = '',    affinity = '' },
    { mineral = 'hematite',            primary = 'SAVE_SPELL',   secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'hornblende',          primary = 'HIT_POINTS',   secondary = 'SHIELD_BLOCK', spell_comp = '',    affinity = '' },
    { mineral = 'howlite',             primary = 'SAVE_POISON',  secondary = 'MOV_REGEN',    spell_comp = '',    affinity = '' },
    { mineral = 'hubnerite',           primary = 'SAVE_FIRE',    secondary = 'DAMROLL',      spell_comp = 'Yes', affinity = 'Divine Aid' },
    { mineral = 'hyalite',             primary = 'ABS_MAGIC',    secondary = 'LUCK',         spell_comp = 'Yes', affinity = 'healing' },
    { mineral = 'iolite',              primary = 'ABSORB_MAGIC', secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'jasper',              primary = 'HP_REGEN',     secondary = 'STR',          spell_comp = '',    affinity = '' },
    { mineral = 'jet',                 primary = 'DODGE',        secondary = 'SNEAK',        spell_comp = 'Yes', affinity = 'healing' },
    { mineral = 'kunzite',             primary = 'CHR',          secondary = 'MANA_REGEN',   spell_comp = 'Yes', affinity = 'Curse' },
    { mineral = 'kyanite',             primary = 'SAVE_COLD',    secondary = 'DAMROLL',      spell_comp = 'Yes', affinity = 'Color Spray' },
    { mineral = 'labradorite',         primary = 'SPELL_RES',    secondary = 'CHR',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'lapis lazuli',        primary = 'ABSORB_ICE',   secondary = 'MANA',         spell_comp = 'Yes', affinity = 'Shards' },
    { mineral = 'larimar',             primary = 'INT',          secondary = 'STR',          spell_comp = '',    affinity = '' },
    { mineral = 'lazulite',            primary = 'ABSORB_ICE',   secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'leucite',             primary = 'HIT_POINTS',   secondary = 'CON',          spell_comp = '',    affinity = '' },
    { mineral = 'limestone',           primary = 'MOVE',         secondary = '',             spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'mahogany obsidian',   primary = 'SAVE_FIRE',    secondary = 'CHR',          spell_comp = 'Yes', affinity = 'Fire' },
    { mineral = 'marlstone',           primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'alteration' },
    { mineral = 'menilite',            primary = 'MOV_REGEN',    secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'mica',                primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'force field spells' },
    { mineral = 'microline',           primary = 'CHR',          secondary = 'MOVE',         spell_comp = '',    affinity = '' },
    { mineral = 'milky quartz',        primary = 'SAVE_ZAP',     secondary = 'MOVE',         spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'moonstone',           primary = 'MANA_REGEN',   secondary = 'MANA',         spell_comp = 'Yes', affinity = 'Harm' },
    { mineral = 'olivine',             primary = 'HIT_POINTS',   secondary = 'SAVE_FIRE',    spell_comp = '',    affinity = '' },
    { mineral = 'ominelite',           primary = 'DODGE',        secondary = 'MOV_REGEN',    spell_comp = 'Yes', affinity = 'lightning' },
    { mineral = 'onyx',                primary = 'Hide',         secondary = 'DEX',          spell_comp = 'Yes', affinity = 'Mass Confusion' },
    { mineral = 'opal',                primary = 'MANA_REGEN',   secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'orange topaz',        primary = 'SAVE_BREATH',  secondary = 'SAVE_SPELL',   spell_comp = 'Yes', affinity = 'Illusion' },
    { mineral = 'orpiment',            primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'padparadsha',         primary = 'MANA_REGEN',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'padparasche',         primary = 'MANA_REGEN',   secondary = 'SAVE_FIRE',    spell_comp = '',    affinity = '' },
    { mineral = 'painite',             primary = 'INT',          secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'peat',                primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'alteration' },
    { mineral = 'peridot',             primary = 'SAVE_FIRE',    secondary = 'SAVE_ZAP',     spell_comp = 'Yes', affinity = 'Fire' },
    { mineral = 'petrified wood',      primary = 'AGE',          secondary = 'WIS',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'petrrified wood',     primary = 'AGE',          secondary = 'WIS',          spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'pezottaite',          primary = 'MANA regen',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'pink jade',           primary = 'LUCK',         secondary = 'WIS',          spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'polyhalite',          primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'torment' },
    { mineral = 'potash',              primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'entangling roots' },
    { mineral = 'potch opal',          primary = 'MANA',         secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'prehnite',            primary = 'STR',          secondary = 'DEX',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'proustite',           primary = 'MOV_REGEN',    secondary = '',             spell_comp = 'Yes', affinity = 'Poison' },
    { mineral = 'puddingstone',        primary = 'HP_REGEN',     secondary = 'MANA_REGEN',   spell_comp = 'Yes', affinity = 'alteration' },
    { mineral = 'pumice',              primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'fatigue' },
    { mineral = 'quartzite',           primary = 'HIT_POINTS',   secondary = 'SAVE_ZAP',     spell_comp = '',    affinity = '' },
    { mineral = 'raw ammolite',        primary = 'MANA_REGEN',   secondary = 'AGE',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'raw earth tears',     primary = 'MANA_REGEN',   secondary = '',             spell_comp = 'Yes', affinity = 'Poison' },
    { mineral = 'raw jet',             primary = 'DODGE',        secondary = 'SNEAK',        spell_comp = 'Yes', affinity = 'Healing' },
    { mineral = 'raw red jade',        primary = 'ABSORB_FIRE',  secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'raw white jade',      primary = 'ABSORB_ZAP',   secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'realgar',             primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'fire' },
    { mineral = 'red jade',            primary = 'ABSORB_FIRE',  secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'red sandstone',       primary = 'CHR',          secondary = 'MOV_REGEN',    spell_comp = '',    affinity = '' },
    { mineral = 'red topaz',           primary = 'SAVE_BREATH',  secondary = 'SAVE_ZAP',     spell_comp = '?',   affinity = '?' },
    { mineral = 'rhyolite',            primary = 'SAVE_FIRE',    secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'riftstone',           primary = 'SAVE_BREATH',  secondary = 'MANA_REGEN',   spell_comp = '',    affinity = '' },
    { mineral = 'rose quartz',         primary = 'SAVE_ZAP',     secondary = 'CHR',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'rough diamond',       primary = '',             secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'ruby',                primary = 'SAVE_FIRE',    secondary = 'SAVE_SPELL',   spell_comp = '',    affinity = '' },
    { mineral = 'rutile',              primary = 'HIT_POINTS',   secondary = 'HITROLL',      spell_comp = 'Yes', affinity = 'Blood' },
    { mineral = 'sal ammoniac',        primary = '',             secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'saltpeter',           primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'fire' },
    { mineral = 'sard',                primary = 'INT',          secondary = 'CHR',          spell_comp = '',    affinity = '' },
    { mineral = 'sardonyx',            primary = 'CHR',          secondary = 'WIS',          spell_comp = '',    affinity = '' },
    { mineral = 'scapolite',           primary = 'MOVE',         secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'scapolite',           primary = 'MOVE',         secondary = '',             spell_comp = 'Yes', affinity = '' },
    { mineral = 'selenite',            primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'healing' },
    { mineral = 'serpentine',          primary = 'MANA',         secondary = 'HIT_POINTS',   spell_comp = '',    affinity = '' },
    { mineral = 'shadow crystal',      primary = '',             secondary = '',             spell_comp = 'Yes', affinity = '' },
    { mineral = 'sheen obsidian',      primary = 'SAVE_FIRE',    secondary = 'MANA_REGEN',   spell_comp = '',    affinity = '' },
    { mineral = 'sillimanite',         primary = 'MANA',         secondary = 'WIS',          spell_comp = 'Yes', affinity = 'Divine Aid' },
    { mineral = 'smoky quartz',        primary = 'SAVE_ZAP',     secondary = 'DODGE',        spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'snowflake obsidian',  primary = 'ABSORB_FIRE',  secondary = 'MANA',         spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'soda niter',          primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'fire spells' },
    { mineral = 'sodalite',            primary = 'HIT_POINTS',   secondary = 'CHR',          spell_comp = '',    affinity = '' },
    { mineral = 'sphene',              primary = 'HIT_POINTS',   secondary = 'MANA',         spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'spinel',              primary = 'SAVE_SPELL',   secondary = '',             spell_comp = 'Yes', affinity = 'Evil' },
    { mineral = 'starstone',           primary = 'MANA_REGEN',   secondary = 'MOVE',         spell_comp = 'Yes', affinity = 'Alteration' },
    { mineral = 'staurolite',          primary = 'WIS',          secondary = 'DAMROLL',      spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'stibnite',            primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'sugilite',            primary = 'DAMROLL',      secondary = 'SAVE_SPELL',   spell_comp = '',    affinity = '' },
    { mineral = 'sunstone',            primary = 'ABSORB_FIRE',  secondary = 'SAVE_FIRE',    spell_comp = 'Yes', affinity = 'Divine Aid' },
    { mineral = 'sylvite',             primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'crystal spear' },
    { mineral = 'taaffeite',           primary = 'DODGE',        secondary = '',             spell_comp = 'Yes', affinity = 'none' },
    { mineral = 'talc (soapstone)',    primary = 'MANA',         secondary = 'MOVE',         spell_comp = '',    affinity = '' },
    { mineral = 'talc',                primary = 'MANA',         secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'thulite',             primary = 'SHIELD_BLOCK', secondary = 'Armor',        spell_comp = 'Yes', affinity = '' },
    { mineral = 'tiger-eye',           primary = 'STR',          secondary = 'CON',          spell_comp = 'Yes', affinity = 'Lightning' },
    { mineral = 'tourmaline',          primary = 'MANA',         secondary = 'INT',          spell_comp = 'Yes', affinity = 'Healing' },
    { mineral = 'triplite',            primary = 'MOV_REGEN',    secondary = 'STR',          spell_comp = 'YES', affinity = 'None' },
    { mineral = 'trona',               primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'forcefields' },
    { mineral = 'turquoise',           primary = 'SAVE_POISON',  secondary = 'HP_REGEN',     spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'verdite',             primary = 'CON',          secondary = 'WIS',          spell_comp = '',    affinity = '' },
    { mineral = 'vermarine',           primary = 'SAVE_ZAP',     secondary = 'WIS',          spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'vespine gas',         primary = '',             secondary = '',             spell_comp = 'Yes', affinity = 'detect poison' },
    { mineral = 'warpstone',           primary = 'RANDOM',       secondary = '',             spell_comp = 'Yes', affinity = 'torment' },
    { mineral = 'wavellite',           primary = 'CHR',          secondary = 'MANA',         spell_comp = 'Yes', affinity = 'None' },
    { mineral = 'white diamond',       primary = 'SAVE_SPELL',   secondary = 'SPELL_RES',    spell_comp = '',    affinity = '' },
    { mineral = 'white jade',          primary = '',             secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'white opal',          primary = 'MANA_REGEN',   secondary = 'LUCK',         spell_comp = '',    affinity = '' },
    { mineral = 'yellow clay',         primary = '',             secondary = '',             spell_comp = '',    affinity = '' },
    { mineral = 'yellow diamond',      primary = 'ATTACK_SPEED', secondary = 'DAMROLL',      spell_comp = '',    affinity = '' },
    { mineral = 'zircon',              primary = 'SPELL_RES',    secondary = 'HIT_POINTS',   spell_comp = 'Yes', affinity = 'None' },
}
minerals = {
    ["abhurite"] = { ore = "tin", purity = "more pure" },
    ["adamite"] = { ore = "zinc", purity = "moderately pure" },
    ["anglesite"] = { ore = "lead", purity = nil },
    ["arjalite"] = { ore = "arjale", purity = nil },
    ["azurite"] = { ore = "copper", purity = nil },
    ["bismite"] = { ore = "bismuth", purity = nil },
    ["bismuthinite"] = { ore = "bismuth", purity = nil },
    ["black veined"] = { ore = "pitch black metal", purity = nil },
    ["bornite"] = { ore = "copper", purity = nil },
    ["braunite"] = { ore = "manganese", purity = nil },
    ["calamine"] = { ore = "zinc", purity = "least pure" },
    ["cassiterite"] = { ore = "tin", purity = nil },
    ["cerussite"] = { ore = "lead", purity = "least pure" },
    ["chalcocite"] = { ore = "copper", purity = nil },
    ["chalcopyrite"] = { ore = "copper", purity = nil },
    ["chert"] = { ore = "zinc", purity = nil },
    ["cinnabar"] = { ore = "quicksilver", purity = nil },
    ["coal"] = { ore = "carbon", purity = nil },
    ["cotunnite"] = { ore = "lead", purity = "moderately pure" },
    ["cuprite"] = { ore = "copper", purity = nil },
    ["engarite"] = { ore = "copper", purity = nil },
    ["galena"] = { ore = "lead", purity = "more pure" },
    ["garnierite"] = { ore = "nickel", purity = nil },
    ["gimlite"] = { ore = "mithril", purity = nil },
    ["goethite"] = { ore = "iron", purity = "less pure" },
    ["greenockite"] = { ore = "cadmium", purity = nil },
    ["greigite"] = { ore = "iron", purity = nil },
    ["hematite"] = { ore = "iron", purity = "more pure" },
    ["iodargyrite"] = { ore = "silver", purity = "more pure" },
    ["iron pyrite"] = { ore = "iron", purity = "least pure" },
    ["limonite"] = { ore = "iron", purity = "less pure" },
    ["loganite"] = { ore = "adamantium", purity = nil },
    ["nephite"] = { ore = "ziff", purity = nil },
    ["malachite"] = { ore = "copper", purity = nil },
    ["maucherite"] = { ore = "nickel", purity = "moderately pure" },
    ["manganite"] = { ore = "manganese", purity = nil },
    ["millerite"] = { ore = "nickel", purity = nil },
    ["mithril"] = { ore = "mithril", purity = "least pure" },
    ["orichalcum"] = { ore = "orichalcum", purity = nil },
    ["psilomelane"] = { ore = "manganese", purity = nil },
    ["pyrargyrite"] = { ore = "silver", purity = "less pure" },
    ["pyrolusite"] = { ore = "manganese", purity = nil },
    ["red veined"] = { ore = "blood red metal", purity = nil },
    ["rhodochrosite"] = { ore = "manganese", purity = nil },
    ["rhodonite"] = { ore = "manganese", purity = nil },
    ["selenide"] = { ore = "selenium", purity = nil },
    ["siderite"] = { ore = "iron", purity = nil },
    ["sphalerite"] = { ore = "zinc", purity = "moderately pure" },
    ["stannite"] = { ore = "tin", purity = nil },
    ["sylvanite"] = { ore = "gold", purity = nil },
    ["teallite"] = { ore = "tin", purity = nil },
    ["tenorite"] = { ore = "copper", purity = nil },
    ["tetrahedrite"] = { ore = "copper", purity = nil },
    ["titanium"] = { ore = "adamantium", purity = "least pure" },
    ["ziff"] = { ore = "ziff", purity = nil },
    ["zinc spar"] = { ore = "zinc", purity = nil },
    ["zincite"] = { ore = "zinc", purity = "less pure" }
}
function purityToSign(purity)
    if purity == "most pure" then
        return ">>"
    elseif purity == "more pure" then
        return ">"
    elseif purity == "less pure" then
        return "<"
    elseif purity == "least pure" then
        return "<<"
    else
        return ""
    end
end

function findClosestLapidaryMineral(mineralName)
    local closestMineral = nil
    local closestDistance = math.huge
    mineralName = string.lower(mineralName)
    for _, m in ipairs(lapidaryMinerals) do
        local distance = EditDistance(m.mineral, mineralName)
        if distance < closestDistance then
            closestMineral = m
            closestDistance = distance
        end
    end
    if closestDistance <= 3 then
        local result = "> " .. closestMineral.primary .. " " .. "< " .. closestMineral.secondary .. " "
        if closestMineral.spell_comp == 'Yes' then
            result = result .. "spellcomp "
        end
        if string.len(closestMineral.affinity) > 0 and closestMineral.affinity ~= "None" then
            result = result .. closestMineral.affinity
        end
        return result
    end
end

function FindClosestMineral(mineral)
    mineral = mineral:lower() -- for case-insensitive matching
    local closest_mineral = nil
    local min_distance = math.huge
    for key, value in pairs(minerals) do
        local distance = EditDistance(mineral, key)
        if distance < min_distance then
            min_distance = distance
            closest_mineral = value
        end
    end
    if min_distance <= 2 then
        local purity_sign = purityToSign(closest_mineral.purity)
        return closest_mineral.ore .. purity_sign
    end
    return findClosestLapidaryMineral(mineral)
end

]]>
</script>


</muclient>
